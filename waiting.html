<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8"><script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
</head>
<body class="bg-slate-50 font-['Tajawal'] flex items-center justify-center min-h-screen">
    <div class="max-w-md w-full bg-white p-10 rounded-[3rem] shadow-2xl text-center">
        <div id="statusIcon" class="text-6xl mb-6 animate-pulse">⏳</div>
        <h2 id="statusText" class="text-2xl font-black text-blue-900 mb-4">بانتظار موافقة الخبير...</h2>
        <p class="text-slate-500 font-bold mb-8">سيصلك تنبيه هنا فور قبول الطلب</p>
        <div id="payArea" class="hidden space-y-4">
            <p class="text-orange-500 font-black mb-4">تم قبول طلبك! يرجى الدفع للتثبيت</p>
            <button onclick="pay()" class="w-full bg-black text-white py-5 rounded-2xl font-black flex items-center justify-center gap-2"> Pay ادفع الآن</button>
            <p class="text-[10px] text-slate-400 font-bold">الدفع آمن عبر مدى، فيزا، و أبل باي</p>
        </div>
    </div>
    <script src="config.js"></script>
    <script>
        const bid = new URLSearchParams(window.location.search).get('bid');
        db.collection("bookings").doc(bid).onSnapshot(doc => {
            const d = doc.data();
            if(d.status === "approved") {
                document.getElementById('statusText').innerText = "تمت الموافقة!";
                document.getElementById('statusIcon').innerText = "✅";
                document.getElementById('statusIcon').classList.remove('animate-pulse');
                document.getElementById('payArea').classList.remove('hidden');
            } else if(d.status === "paid") {
                location.href = `chat.html?bid=${bid}`;
            }
        });
        async function pay() {
            await db.collection("bookings").doc(bid).update({ status: "paid" });
        }
    </script>
</body>
</html>
