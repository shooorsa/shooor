<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ø§Ù„Ø®Ø¨ÙŠØ± | Ø´Ù€Ù€Ù€ÙˆÙˆÙˆØ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <style>body { font-family: 'Tajawal', sans-serif; }</style>
</head>
<body class="bg-slate-50 text-slate-900">

    <div class="max-w-md mx-auto bg-white min-h-screen shadow-lg relative">
        <div class="h-32 bg-blue-900"></div>
        
        <div class="px-6 -mt-12 text-center">
            <div id="expert-icon" class="w-24 h-24 bg-white border-4 border-white rounded-full mx-auto flex items-center justify-center text-4xl shadow-md">
                ğŸ‘¤
            </div>
            <h1 id="expert-name" class="text-2xl font-black mt-4 text-blue-900 italic">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</h1>
            <div id="expert-tags" class="flex flex-wrap justify-center gap-2 mt-2"></div>
        </div>

        <div class="p-8 space-y-6">
            <div class="bg-slate-50 p-6 rounded-[2rem] border border-slate-100 text-right">
                <h3 class="font-black text-[10px] text-orange-500 mb-2 uppercase tracking-widest">Ø¹Ù† Ø§Ù„Ø®Ø¨ÙŠØ± ÙˆØ§Ù„Ø´ÙˆØ±:</h3>
                <p id="expert-detail" class="text-sm leading-relaxed text-slate-600 font-bold">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„ØªÙØ§ØµÙŠÙ„...</p>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div class="bg-blue-50 p-4 rounded-2xl text-center">
                    <p class="text-[9px] text-blue-400 font-black uppercase">Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±Ø©</p>
                    <p class="font-black text-blue-900">50 Ø±.Ø³</p>
                </div>
                <div class="bg-blue-50 p-4 rounded-2xl text-center">
                    <p class="text-[9px] text-blue-400 font-black uppercase">Ù…Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø©</p>
                    <p class="font-black text-blue-900">30 Ø¯Ù‚ÙŠÙ‚Ø©</p>
                </div>
            </div>

            <button id="request-btn" onclick="sendConsultationRequest()" class="w-full bg-blue-900 text-white py-5 rounded-2xl font-black shadow-xl hover:bg-orange-500 transition-all transform hover:scale-[1.02]">
                Ø§Ø·Ù„Ø¨ Ø§Ù„Ø´ÙˆØ± Ø§Ù„Ø¢Ù†
            </button>
            
            <a href="index.html" class="block text-center text-slate-400 text-[10px] font-black uppercase tracking-widest mt-4">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAZSFCf7piwKykf_klgGlzc4RkCXumNRUg",
            authDomain: "shooor-app.firebaseapp.com",
            projectId: "shooor-app",
            storageBucket: "shooor-app.firebasestorage.app",
            messagingSenderId: "356426973132",
            appId: "1:356426973132:web:6353917bf13a64074d6769"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Ø¬Ù„Ø¨ Ù…Ø¹Ø±Ù Ø§Ù„Ø®Ø¨ÙŠØ± Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·
        const urlParams = new URLSearchParams(window.location.search);
        const expertId = urlParams.get('id') || 'khaled'; 

        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø¨Ø±Ø§Ø¡ (ÙŠÙ…ÙƒÙ†Ùƒ Ù„Ø§Ø­Ù‚Ø§Ù‹ Ù†Ù‚Ù„Ù‡Ø§ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù€ Firestore)
        const expertsData = {
            "khaled": {
                name: "Ø®Ø§Ù„Ø¯ Ø§Ù„Ø­Ø³Ù†ÙŠÙ†",
                tags: ["Ø®Ø¨ÙŠØ± Ù†ÙØ³ÙŠØ©", "Ù…Ø³ØªØ´Ø§Ø± Ø³ÙØ±", "ØªØ¹Ø§ÙÙŠ"],
                detail: "Ø®Ø¶Øª ØªØ¬Ø±Ø¨Ø© Ø§Ù„ØªØ¹Ø§ÙÙŠ Ø§Ù„Ù†ÙØ³ÙŠ ÙˆØ£Ø³Ø§Ø¹Ø¯Ùƒ ÙÙŠ Ø§Ù„ØªØ®Ø·ÙŠØ· Ù„Ø±Ø­Ù„Ø§Øª Ø¹Ù„Ø§Ø¬ÙŠØ© Ù…Ø±ÙŠØ­Ø© ÙˆÙ†Ù‚Ù„ ØªØ¬Ø±Ø¨Ø© ÙˆØ§Ù‚Ø¹ÙŠØ©.",
                icon: "ğŸ§ "
            }
        };

        const data = expertsData[expertId];
        if (data) {
            document.getElementById('expert-name').innerText = data.name;
            document.getElementById('expert-detail').innerText = data.detail;
            document.getElementById('expert-icon').innerText = data.icon;
            data.tags.forEach(tag => {
                document.getElementById('expert-tags').innerHTML += `<span class="bg-orange-100 text-orange-600 px-3 py-1 rounded-full text-[9px] font-black">#${tag}</span>`;
            });
        }

        async function sendConsultationRequest() {
            const user = auth.currentUser;
            if (!user) {
                alert("ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹.");
                window.location.href = 'index.html#customer-register';
                return;
            }

            const btn = document.getElementById('request-btn');
            btn.disabled = true; btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨...";

            try {
                const requestRef = await db.collection("consultations").add({
                    userId: user.uid,
                    userName: user.displayName || user.phoneNumber || "Ù…Ø³ØªØ®Ø¯Ù…",
                    expertName: data ? data.name : "Ø®Ø¨ÙŠØ±",
                    status: "pending",
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                // Ø§Ù„ØªÙˆØ¬Ù‡ Ù„ØµÙØ­Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ­Ø¯Ø©
                window.location.href = `waiting.html?requestId=${requestRef.id}&expert=${encodeURIComponent(data.name)}`;
            } catch (error) {
                alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ©.");
                btn.disabled = false; btn.innerText = "Ø§Ø·Ù„Ø¨ Ø§Ù„Ø´ÙˆØ± Ø§Ù„Ø¢Ù†";
            }
        }
    </script>
</body>
</html>
