<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8"><script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <style>.slot.selected { background: #1e3a8a; color: white; border-color: #1e3a8a; }</style>
</head>
<body class="bg-slate-50 font-['Tajawal']">
    <div class="max-w-2xl mx-auto bg-white min-h-screen shadow-2xl pb-20 border-x">
        <div class="h-40 bg-blue-900 flex items-end justify-center pb-6"><div class="w-24 h-24 bg-white rounded-full border-4 border-white shadow-lg overflow-hidden flex items-center justify-center text-4xl">ğŸ‘¤</div></div>
        <div class="p-8 text-center border-b">
            <h1 id="eName" class="text-3xl font-black text-blue-900 mb-2">...</h1>
            <div id="badges" class="flex justify-center gap-2 mb-4"></div>
            <p id="eBio" class="text-slate-600 font-bold leading-relaxed mb-6"></p>
        </div>
        <div class="p-8">
            <h3 class="font-black text-blue-900 mb-4">Ø§Ø®ØªØ± ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±Ø© (30 Ø¯Ù‚ÙŠÙ‚Ø©):</h3>
            <div id="slotsGrid" class="grid grid-cols-2 md:grid-cols-3 gap-3 mb-8"></div>
            <button id="bookBtn" onclick="book()" disabled class="w-full bg-slate-300 text-white py-5 rounded-2xl font-black text-lg transition-all">Ø§Ø®ØªØ± ÙˆÙ‚Øª Ø£ÙˆÙ„Ø§Ù‹</button>
        </div>
    </div>
    <script src="config.js"></script>
    <script>
        const id = new URLSearchParams(window.location.search).get('id');
        let selTime = null;
        async function load() {
            const doc = await db.collection("experts").doc(id).get();
            const d = doc.data();
            document.getElementById('eName').innerText = d.name;
            document.getElementById('eBio').innerText = d.bio;
            d.badges.forEach(b => document.getElementById('badges').innerHTML += `<span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-[10px] font-black">âœ”ï¸ ${b}</span>`);
            d.slots.forEach(s => document.getElementById('slotsGrid').innerHTML += `<button onclick="sel(this, '${s}')" class="slot border-2 p-3 rounded-xl font-bold text-sm hover:border-blue-900 transition-all">${s}</button>`);
        }
        function sel(btn, t) {
            document.querySelectorAll('.slot').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected'); selTime = t;
            const b = document.getElementById('bookBtn'); b.disabled = false; b.classList.replace('bg-slate-300', 'bg-blue-900');
        }
        async function book() {
            const u = auth.currentUser; if(!u) return alert("Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ø£ÙˆÙ„Ø§Ù‹");
            const res = await db.collection("bookings").add({ userId: u.uid, userName: u.displayName, expertId: id, expertName: document.getElementById('eName').innerText, time: selTime, status: "pending", createdAt: new Date() });
            location.href = `waiting.html?bid=${res.id}`;
        }
        load();
    </script>
</body>
</html>
